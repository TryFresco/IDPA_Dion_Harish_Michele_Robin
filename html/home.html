<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <script src="https://cdn.maptiler.com/maptiler-geocoder/v1.1.0/maptiler-geocoder.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <link href="https://cdn.maptiler.com/maptiler-geocoder/v1.1.0/maptiler-geocoder.css" rel="stylesheet" />
    <link rel="stylesheet" href="../css/home.css">

    <script>
        var orgn
        var dest
        var depD
        var retD
        var isTwoWayFlight = false

        function getCo2Emission() {
            orgn = String(document.querySelector("#orgArpt").value)
            dest = String(document.querySelector('#destArpt').value)
            depD = String(document.querySelector('#depDate').value)
            retD = String(document.querySelector('#retDate').value)

            if (orgn === "" || dest === "" || depD === "" || ) {
                alert("Please fill in every field")
            } else {
                if (retD !== "") {
                    isTwoWayFlight = true
                }
                getNewToken()
            }

        }


        function getNewToken() {
            var settings = {
                "url": "https://test.api.amadeus.com/v1/security/oauth2/token",
                "method": "POST",
                "timeout": 0,
                "headers": {
                    "Content-Type": "application/x-www-form-urlencoded"
                },
                "data": {
                    "grant_type": "client_credentials",
                    "client_id": "Yxs2IrBtYmbigUIpgFr5WaUnXLp7Njft",
                    "client_secret": "XNWRKO8Gw0cgLsGG"
                }
            };

            $.ajax(settings).done(function(response) {
                var obj = JSON.parse(JSON.stringify(response))
                var result = obj.access_token
                console.log(result)


                getFlightOffer(orgn.toUpperCase(), dest.toUpperCase(), depD, retD, result)
                    //getFlightOffer(toString(document.getElementById("orgArpt")), toString(document.getElementById("destArpt")), toString(document.getElementById("depDate")), toString(retD = document.getElementById("retDate")), result)
            });
        }

        function getFlightOffer(origin, destination, departureDate, returnDate, token) {
            console.log(origin)
            console.log(destination)
            console.log(departureDate)
            console.log(returnDate)
            var settings = {
                "url": "https://test.api.amadeus.com/v2/shopping/flight-offers?originLocationCode=" + origin + "&destinationLocationCode=" + destination + "&departureDate=" + departureDate + "&returnDate=" + returnDate + "&adults=1&max=3",
                "method": "GET",
                "timeout": 0,
                "headers": {
                    "Authorization": "Bearer " + token
                },
            };

            $.ajax(settings).done(function(response) {


                var flightOfferData = response.data

                console.log(flightOfferData)

                flightOffersPricing(token, flightOfferData)

                /*
                var relevantData = response.data

                return relevantData;
                */
            });
        }


        function flightOffersPricing(token, data) {
            console.log(data)
            var settings = {
                "url": "https://test.api.amadeus.com/v1/booking/flight-orders",
                "method": "POST",
                "timeout": 0,
                "headers": {
                    "Content-Type": "application/json",
                    "Authorization": "Bearer " + token
                },
                "data": JSON.stringify({
                    "data": {
                        "type": "flight-order",
                        "flightOffers": [
                            data[0]
                        ],

                        "travelers": [{
                            "id": "1",
                            "dateOfBirth": "2012-10-11",
                            "gender": "FEMALE",
                            "contact": {
                                "emailAddress": "jorge.gonzales833@telefonica.es",
                                "phones": [{
                                    "deviceType": "MOBILE",
                                    "countryCallingCode": "34",
                                    "number": "480080076"
                                }]
                            },
                            "name": {
                                "firstName": "ADRIANA",
                                "lastName": "GONZALES"
                            }
                        }],
                        "remarks": {
                            "general": [{
                                "subType": "GENERAL_MISCELLANEOUS",
                                "text": "ONLINE BOOKING FROM INCREIBLE VIAJES"
                            }]
                        },
                        "ticketingAgreement": {
                            "option": "DELAY_TO_CANCEL",
                            "delay": "6D"
                        },
                        "contacts": [{
                            "addresseeName": {
                                "firstName": "PABLO",
                                "lastName": "RODRIGUEZ"
                            },
                            "companyName": "INCREIBLE VIAJES",
                            "purpose": "STANDARD",
                            "phones": [{
                                "deviceType": "LANDLINE",
                                "countryCallingCode": "34",
                                "number": "480080071"
                            }, {
                                "deviceType": "MOBILE",
                                "countryCallingCode": "33",
                                "number": "480080072"
                            }],
                            "emailAddress": "support@increibleviajes.es",
                            "address": {
                                "lines": [
                                    "Calle Prado, 16"
                                ],
                                "postalCode": "28014",
                                "cityName": "Madrid",
                                "countryCode": "ES"
                            }
                        }]
                    }
                }),
            };

            $.ajax(settings).done(function(response) {
                console.log(response);
                var finalEmissions = response.data.flightOffers[0].itineraries[0].segments[0].co2Emissions[0].weight

                if (isTwoWayFlight == true) {
                    finalEmissions = finalEmissions * 2
                }

                console.log("CO2 Emissions for flight: " + finalEmissions + "kg")

            });
        }

        function btnOnClick() {
            getCo2Emission()
        }
    </script>

    <title>Home</title>
</head>

<body>

    <div class="container">
        <div class="row">
            <div class="col-2"> </div>
            <div class="col-2">
                <input id="orgArpt" class="inputField" type="text" placeholder="Origin Airport">
            </div>

            <div class="col-2">
                <input id="destArpt" class="inputField" type="text" placeholder="Destination Airport">
            </div>

            <div class="col-2">
                <input id="depDate" class="inputField" type="date" placeholder="Departure Date">
            </div>
            <div class="col-2">
                <input id="retDate" class="inputField" type="date" placeholder="Retour Date">
            </div>
            <div class="col-2"> </div>
        </div>
        <br><br>
        <div class="row">
            <div class="col-5"></div>
            <div class="col-2">
                <button class="button-3 " role="button " onclick="btnOnClick()">Calculate</button>
            </div>
            <div class="col-5"></div>
        </div>
    </div>





</body>

</html>